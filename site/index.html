<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Arf Blocks</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Arf Blocks">
    <meta name="theme-color" content="#6C5CE7">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="assets/icon-192.png">
    <link rel="apple-touch-startup-image" href="assets/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-1668x2224.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-1242x2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-828x1792.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="assets/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
</head>
<body>
    <div id="game-container">
        <header>
            <h1>Arf Blocks</h1>
            <div class="score-container">
                <span id="score">0</span>
            </div>
        </header>
        
        <main>
            <canvas id="game-board"></canvas>
            
            <div id="next-pieces">
                <div class="pieces-container">
                    <canvas id="piece-1" class="next-piece"></canvas>
                    <canvas id="piece-2" class="next-piece"></canvas>
                    <canvas id="piece-3" class="next-piece"></canvas>
                </div>
            </div>
        </main>

        <footer>
            <button id="new-game">New Game</button>
            <button id="fullscreen-button" style="display: none; margin-left: 10px; background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                <span id="fullscreen-icon">⛶</span>
            </button>
            <button id="install-button" style="display: none; margin-left: 10px; background: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                Install App
            </button>
            <div style="font-size: 8px; opacity: 0.3; margin-top: 4px;">v1.5.0</div>
        </footer>
    </div>

    <div id="ios-install-prompt" style="display: none; position: fixed; bottom: 0; left: 0; right: 0; background: #f8f8f8; padding: 10px 20px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center; z-index: 1000;">
        <p style="margin: 0; font-weight: bold;">Install this app on your device</p>
        <p style="margin: 5px 0;">Tap <span style="font-size: 1.5em; vertical-align: middle;">⤴</span> and then "Add to Home Screen"</p>
        <button id="close-install-prompt" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-top: 5px;">Close</button>
    </div>

    <script src="js/pwa.js"></script>
    <script type="module" src="js/game.js?v=1.5.0"></script>
    <script>
        // Check if fullscreen is supported
        function isFullscreenSupported() {
            return (
                document.fullscreenEnabled ||
                document.webkitFullscreenEnabled ||
                document.mozFullScreenEnabled ||
                document.msFullscreenEnabled
            );
        }
        
        // Toggle fullscreen
        function toggleFullscreen() {
            const doc = document.documentElement;
            
            if (!document.fullscreenElement) {
                // Enter fullscreen
                if (doc.requestFullscreen) {
                    doc.requestFullscreen();
                } else if (doc.webkitRequestFullscreen) {
                    doc.webkitRequestFullscreen();
                } else if (doc.mozRequestFullScreen) {
                    doc.mozRequestFullScreen();
                } else if (doc.msRequestFullscreen) {
                    doc.msRequestFullscreen();
                }
                document.getElementById('fullscreen-icon').textContent = '⛶';
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                document.getElementById('fullscreen-icon').textContent = '⛶';
            }
        }
        
        // Check if we're on a mobile device
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Show fullscreen button on mobile devices if fullscreen is supported
        if (isMobile && isFullscreenSupported()) {
            const fullscreenButton = document.getElementById('fullscreen-button');
            fullscreenButton.style.display = 'inline-block';
            fullscreenButton.addEventListener('click', toggleFullscreen);
        }
        
        // PWA installation
        let deferredPrompt;
        const installButton = document.getElementById('install-button');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            installButton.style.display = 'inline-block';
        });
        
        installButton.addEventListener('click', () => {
            // Hide the install button
            installButton.style.display = 'none';
            // Show the prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                    // Show the button again if they dismissed
                    installButton.style.display = 'inline-block';
                }
                deferredPrompt = null;
            });
        });
        
        // iOS specific install prompt
        if (
            ('standalone' in navigator) && 
            (!navigator.standalone) && 
            (/iphone|ipod|ipad/i.test(navigator.userAgent)) && 
            (/Safari/i.test(navigator.userAgent)) && 
            !(/(CriOS|FxiOS|OPiOS|mercury)/i.test(navigator.userAgent))
        ) {
            document.getElementById('ios-install-prompt').style.display = 'block';
        }
        
        document.getElementById('close-install-prompt').addEventListener('click', function() {
            document.getElementById('ios-install-prompt').style.display = 'none';
            localStorage.setItem('installPromptDismissed', 'true');
        });
        
        if (localStorage.getItem('installPromptDismissed') === 'true') {
            document.getElementById('ios-install-prompt').style.display = 'none';
        }
    </script>
</body>
</html> 